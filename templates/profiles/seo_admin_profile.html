{% extends 'base.html' %}

{% block content %}
    <div class="profile-wrapper">
        <h1>{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}</h1>
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å, {{ username }}! ::: –í–∞—à–∞ —Ä–æ–ª—å {{ userrole }}</p>
            <hr>
                <p>–í—ã –∞–¥–º–∏–Ω SEO –û—Ç–¥–µ–ª–∞ "[–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û]"</p>
                <hr>
                    <div class="container">
                        <h1>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
                        <form method="POST" action="/add_user">
                            <div class="form-group">
                                <label for="username">–õ–æ–≥–∏–Ω:</label>
                                <input type="text" class="form-control" id="username" name="username" required pattern="[A-Za-z0-9]+">
                            </div>
                            <div class="form-group" id="form-group-password">
                                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                                <button class="btn btn-warning custom-button no-active" type="button" id="generate-password-button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="btn btn-danger custom-button no-active" type="button" id="show-password-button">üëÅ</button>
                                <input type="password" class="form-control" id="password" name="password" pattern="^[A-Za-z0-9!@#$%^&*()_+=-]+$" required>
                            </div>
                            <div class="form-group" id="form-group-resource">
                                <label for="resource">–†–µ—Å—É—Ä—Å:</label>
                                <button type="button" class="btn btn-primary" id="bitrix24-button">–ë–∏—Ç—Ä–∏–∫—Å24</button>
                                <button type="button" class="btn btn-primary" id="email-button">–ü–æ—á—Ç–∞</button>
                                <input type="text" class="form-control" id="resource" name="userresource" required pattern="[A-Za-z0-9]+">
                            </div>
                            
                            <div class="select-form">
                                <label for="userrole">–†–æ–ª—å:</label>
                                <select class="custom-select custom-select-sm" name="userrole" id="userrole">
                                    {% for role in roles %}
                                        <option value="{{ role }}">{{ role }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="select-form">
                                <label for="userdepart">–û—Ç–¥–µ–ª:</label>
                                <select class="custom-select custom-select-sm" name="userdepart" id="userdepart">
                                    {% for department in departments %}
                                        <option value="{{ department['departname'] }}">{{ department['departname'] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <hr>
                            <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </form>
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                            <ul class="flash">
                                {% for message in messages %}
                                <li>{{ message }}</li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        {% endwith %}
                    </div>
    </div>

    <script>
        // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É "–ë–∏—Ç—Ä–∏–∫—Å24" –ø–æ –µ–µ id
        var bitrix24Button = document.getElementById('bitrix24-button');
    
        // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ —Ä–µ—Å—É—Ä—Å–∞ –ø–æ –µ–≥–æ id
        var resourceField = document.getElementById('resource');
    
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏
        bitrix24Button.addEventListener('click', function() {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ —Ä–µ—Å—É—Ä—Å–∞ —Ç–µ–∫—Å—Ç–æ–º "–ë–∏—Ç—Ä–∏–∫—Å24"
            resourceField.value = 'Bitrix24';
        });

        var bitrix24Button = document.getElementById('email-button');
        var resourceField = document.getElementById('resource');
        bitrix24Button.addEventListener('click', function() {
            resourceField.value = 'Email';
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
        function generatePassword(length) {
        const charset = "abcdefghjkmnopqrstuvwxyzABCDEFGHJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+=-]+$";
        let password = "";
        for (let i = 0; i < length; i++) {
            const randomIndex = Math.floor(Math.random() * charset.length);
            password += charset.charAt(randomIndex);
        }
        return password;
        }

        var passwordField = document.getElementById('password');
        var generatePasswordButton = document.getElementById('generate-password-button');

        generatePasswordButton.addEventListener('click', function() {
            var generatedPassword = generatePassword(24); // –ò–∑–º–µ–Ω–∏—Ç–µ –¥–ª–∏–Ω—É –ø–∞—Ä–æ–ª—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            passwordField.value = generatedPassword;
        });


        // –í–∏–¥–∏–º–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è
        var passwordField = document.getElementById('password');
        var generatePasswordButton = document.getElementById('generate-password-button');
        var showPasswordButton = document.getElementById('show-password-button');
        var isPasswordVisible = false;

        showPasswordButton.addEventListener('click', function() {
            isPasswordVisible = !isPasswordVisible;
            passwordField.type = isPasswordVisible ? 'text' : 'password';
            //showPasswordButton.textContent = isPasswordVisible ? '–°–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å';
        });
    </script>
        {% endblock %}