{% extends 'base.html' %}

{% block title %}–ö–∞–±–∏–Ω–µ—Ç{% endblock %}
{% block additional_styles %}<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">{% endblock %}
{% block content %}
    <div class="profile-wrapper">
            <p id="welcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ username }}.</p>
            <hr>
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h1>
                <div class="container add-user-form">
                        <form method="POST" action="/add_user_password">
                            <div class="form-group">
                                <label for="username">–ò–º—è</label>
                                <select name="username" id="username"></select>
                                <input type="text" class="form-control" id="username" name="username" placeholder="–ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫">
                            </div>
                            <div class="form-group">
                                <label for="userlogin">–õ–æ–≥–∏–Ω</label>
                                <input type="text" class="form-control" id="userlogin" name="userlogin" required>
                            </div>
                            <div class="form-group" id="form-group-password">
                                <label for="password">–ü–∞—Ä–æ–ª—å</label>
                                <div class="form-btn-wrapper"><button class="btn btn-warning custom-button no-active" type="button" id="generate-password-button">üé≤</button></div>
                                <div class="form-btn-wrapper"><button class="btn btn-danger custom-button no-active" type="button" id="show-password-button">üëÅ</button></div>
                                <input type="password" class="form-control" id="password" name="password" required>
                                <div id="password-strength"></div>
                            </div>
                            <div class="form-group" id="form-group-resource">
                                <label for="resource">–†–µ—Å—É—Ä—Å</label>
                                <div class="form-btn-wrapper"><button type="button" class="btn btn-primary" id="bitrix24-button">–ë24</button></div>
                                <div class="form-btn-wrapper"><button type="button" class="btn btn-primary" id="email-button">üìß</button></div>
                                <input type="text" class="form-control" id="resource" name="userresource" required>
                            </div>
                            
                            <div class="select-form">
                                <label for="userrole">–†–æ–ª—å</label>
                                <select class="custom-select custom-select-sm custom-select-add-user" name="userrole" id="userrole">
                                    {% for role in roles %}
                                        <option value="{{ role }}">{{ role }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <!-- <div class="select-form">
                                <label for="userdepart">–û—Ç–¥–µ–ª</label>
                                <select class="custom-select custom-select-sm custom-select-add-user" name="userdepart" id="userdepart">
                                    {% for department in departments %}
                                        <option value="{{ department }}">{{ department }}</option>
                                    {% endfor %}
                                </select>
                            </div> -->
                            <div class="add-btn-wrapper"><button type="submit" class="btn btn-primary add-btn">–î–æ–±–∞–≤–∏—Ç—å</button></div>
                        </form>
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                            <ul class="flash">
                                {% for message in messages %}
                                <li>{{ message }}</li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        {% endwith %}
                    </div>
                        <hr>
                        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö</h2>
                    <div class="table-accounts-filter">
                        <select class="custom-select custom-select-sm" id="filter-username-select">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–º—è –∏–∑ —Å–ø–∏—Å–∫–∞</option>
                        </select>
                        <input class="form-control" type="text" id="filter-username-input" placeholder="---–í–≤–µ–¥–∏—Ç–µ –∏–º—è--- ">
                        <!-- <select class="custom-select custom-select-sm" id="filter-role">
                            <option value="">–§–∏–ª—å—Ç—Ä –ø–æ –†–æ–ª–∏</option>
                        </select>
                        <select class="custom-select custom-select-sm" id="filter-depart">
                            <option value="">–§–∏–ª—å—Ç—Ä –ø–æ –û—Ç–¥–µ–ª—É</option>
                        </select>
                        <select class="custom-select custom-select-sm" id="filter-resource">
                            <option value="">–§–∏–ª—å—Ç—Ä –ø–æ –†–µ—Å—É—Ä—Å—É</option>
                        </select> -->
                    </div>
                    <div class="table-accounts-container">
                        <table class="table table-striped" id="table-users-info">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ò–º—è</th>
                                    <th>–õ–æ–≥–∏–Ω</th>
                                    <th>–†–µ—Å—É—Ä—Å</th>
                                    <th>–ü–∞—Ä–æ–ª—å</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–û—Ç–¥–µ–ª</th>
                                    <th>–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                    <th>–ö—Ç–æ —Å–æ–∑–¥–∞–ª</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for account in accounts %}
                                    <tr>
                                        <td id="table-userid">{{ account.userid }}</td>
                                        <td data-filter="username">{{ account.username }}</td>
                                        <td>{{ account.userlogin }}</td>
                                        <td data-filter="userresource">{{ account.userresource }}</td>
                                        <td class="password-cell">
                                            <div class="password-info">
                                                <span class="password-hidden">{{ "*" * account.userpassword|length }}</span>
                                            </div>
                                            <div class="password-actions">
                                                <button class="btn show-password-table-button">üëÅ</button>
                                                <button class=" btn copy-password-button">üìë</button>
                                            </div>
                                        </td>
                                        <td data-filter="userrole">{{ account.userrole }}</td>
                                        <td data-filter="userdepart">{{ account.userdepart }}</td>
                                        <td>{{ account.created }}</td>
                                        <td>{{ account.whocreate }}</td>
                                    </tr>

                                    
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
    </div>
    <script>
        var passwords = [];
        "{% for account in accounts %}"
            passwords.push("{{ account.userpassword }}")
        "{% endfor %}"
        var showPasswordButtons = document.querySelectorAll('.show-password-table-button');
        
        console.log(passwords)
        console.log(showPasswordButtons)

        showPasswordButtons.forEach(function (button, index) {
            button.addEventListener('click', function () {
                var index = Array.from(showPasswordButtons).indexOf(button);
                var passwordCell = button.closest('tr').querySelector('.password-cell');
                var passwordHidden = passwordCell.querySelector('.password-hidden');

                if (passwordHidden.textContent === '*'.repeat(passwords[index].length)) {
                    passwordHidden.textContent = passwords[index];
                    console.log(passwordHidden.textContent)
                } else {
                    passwordHidden.innerHTML = '*'.repeat(passwords[index].length);
                }
                
                
                
            });
        });
    </script>
    <script src="{{ url_for('static', filename='js/it_admin_profile.js') }}"></script>
        {% endblock %}